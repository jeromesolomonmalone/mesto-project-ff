(()=>{"use strict";var e=document.querySelector("#card-template").content;function t(t,n,r,o,c,a,i,s){var u=e.querySelector(".places__item").cloneNode(!0);u.querySelector(".card__image").src=t.link,u.querySelector(".card__image").alt=t.name,u.querySelector(".card__title").textContent=t.name;var l=u.querySelector(".number__likes");l.textContent=t.likes.length;var d=u.querySelector(".card__delete-button");n!==t.owner._id&&d.remove(),d.addEventListener("click",(function(){!function(e,t,n){n(e).then((function(){t.remove()})).catch((function(e){return console.log("Ошибка.....: ".concat(e))}))}(t._id,u,s)}));var p=u.querySelector(".card__like-button");return t.likes.some((function(e){return e._id===n}))&&p.classList.add("card__like-button_is-active"),p.addEventListener("click",(function(){p.classList.contains("card__like-button_is-active")?o(t._id,p,l,a):r(t._id,p,l,c)})),u.querySelector(".card__image").addEventListener("click",(function(){i(t)})),u}function n(e,t,n,r){r(e).then((function(e){t.classList.add("card__like-button_is-active"),n.textContent=e.likes.length})).catch((function(e){return console.log("Ошибка.....: ".concat(e))}))}function r(e,t,n,r){r(e).then((function(e){t.classList.remove("card__like-button_is-active"),n.textContent=e.likes.length})).catch((function(e){return console.log("Ошибка.....: ".concat(e))}))}function o(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",a)}function c(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",a)}function a(e){"Escape"===e.key&&c(document.querySelector(".popup_is-opened"))}var i,s,u,l,d,p,f,m=function(e,t,n){var r=n.inputErrorClass,o=n.errorClass,c=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(r),t.setCustomValidity(""),c.classList.remove(o),c.textContent=""},_=function(e,t,n){var r=n.inactiveButtonClass;!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(r),t.disabled=!1):(t.classList.add(r),t.disabled=!0)},v=function(e,t,n){var r=n.inputErrorClass;n.errorClass,m(e,t,r)},h={baseUrl:"https://nomoreparties.co/v1/wff-cohort-18",headers:{authorization:"4c84455c-b37c-4017-b90f-e1abc3cb4dd2","Content-Type":"application/json"}},y=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},C=function(e){return fetch("".concat(h.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:h.headers}).then(y)},S=function(e){return fetch("".concat(h.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:h.headers}).then(y)},b=function(e){return fetch("".concat(h.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:h.headers}).then(y)},E=document.querySelector(".places__list"),q=document.querySelector(".profile__edit-button"),g=document.querySelector(".profile__add-button"),k=document.querySelector(".popup_type_edit"),L=document.querySelector(".popup_type_new-card"),x=document.querySelector(".popup_type_edit-avatar"),B=document.querySelectorAll(".popup__close"),U=document.querySelectorAll(".popup"),T=document.forms["edit-profile"],A=T.elements.name,w=T.elements.description,D=document.querySelector(".profile__title"),P=document.querySelector(".profile__description"),N=document.forms["new-place"],O=N.elements["place-name"],j=N.elements.link,J=document.querySelector(".popup_type_image"),M=document.querySelector(".profile__image"),V=document.querySelector(".button_edit-profile"),H=document.querySelector(".button_new-place"),I=document.querySelector(".button_edit-avatar"),z=document.forms["edit-avatar"],F=z.elements.avatar,G=null,K={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function Q(e){J.querySelector(".popup__image").src=e.link,J.querySelector(".popup__image").alt=e.name,J.querySelector(".popup__caption").textContent=e.name,o(J)}function R(e,t){t.textContent=e?"Сохранение...":"Сохранить"}Promise.all([fetch("".concat(h.baseUrl,"/users/me"),{headers:h.headers}).then(y),fetch("".concat(h.baseUrl,"/cards"),{headers:h.headers}).then(y)]).then((function(e){var o=e[0];D.textContent=o.name,P.textContent=o.about,M.style.backgroundImage="url("+o.avatar+")",A.value=D.textContent,w.value=P.textContent,F.value=o.avatar,G=o._id,e[1].forEach((function(e){E.append(t(e,G,n,r,S,b,Q,C))}))})).catch((function(e){console.log(e)})),U.forEach((function(e){e.classList.add("popup_is-animated")})),q.addEventListener("click",(function(){A.value=D.textContent,w.value=P.textContent,o(k),v(T,A,K),v(T,w,K)})),g.addEventListener("click",(function(){o(L)})),M.addEventListener("click",(function(){o(x)})),B.forEach((function(e){e.addEventListener("click",(function(){U.forEach(c)}))})),U.forEach((function(e){e.addEventListener("click",(function(e){e.target===e.currentTarget&&c(e.currentTarget)}))})),T.addEventListener("submit",(function(e){var t;e.preventDefault(),R(!0,V),(t={name:A.value,about:w.value},fetch("".concat(h.baseUrl,"/users/me"),{method:"PATCH",headers:h.headers,body:JSON.stringify(t)}).then(y)).then((function(e){D.textContent=e.name,P.textContent=e.about,c(k)})).catch((function(e){return console.log("Ошибка.....: ".concat(e))})).finally((function(){R(!1,V)}))})),N.addEventListener("submit",(function(e){var o;e.preventDefault(),R(!0,H),(o={name:O.value,link:j.value},fetch("".concat(h.baseUrl,"/cards"),{method:"POST",headers:h.headers,body:JSON.stringify(o)}).then(y)).then((function(e){E.prepend(t(e,G,n,r,S,b,Q,C)),c(L)})).catch((function(e){return console.log("Ошибка.....: ".concat(e))})).finally((function(){R(!1,H),e.target.reset(),v(N,O,K),v(N,j,K)}))})),z.addEventListener("submit",(function(e){var t;e.preventDefault(),R(!0,I),(t={avatar:F.value},fetch("".concat(h.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:h.headers,body:JSON.stringify(t)}).then(y)).then((function(e){M.style.backgroundImage="url("+e.avatar+")",c(x)})).catch((function(e){return console.log("Ошибка.....: ".concat(e))})).finally((function(){R(!1,I)}))})),s=(i=K).formSelector,u=i.inputSelector,l=i.submitButtonSelector,d=i.inactiveButtonClass,p=i.inputErrorClass,f=i.errorClass,Array.from(document.querySelectorAll(s)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=t.inputSelector,r=t.submitButtonSelector,o=t.inactiveButtonClass,c=t.inputErrorClass,a=t.errorClass,i=Array.from(e.querySelectorAll(n)),s=e.querySelector(r);_(i,s,{inactiveButtonClass:o}),i.forEach((function(t){t.addEventListener("input",(function(){!function(e,t,n){var r=n.inputErrorClass,o=n.errorClass;t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?m(e,t,{inputErrorClass:r,errorClass:o}):function(e,t,n,r){var o=r.inputErrorClass,c=r.errorClass,a=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o),a.textContent=n,a.classList.add(c)}(e,t,t.validationMessage,{inputErrorClass:r,errorClass:o})}(e,t,{inputErrorClass:c,errorClass:a}),_(i,s,{inactiveButtonClass:o})}))}))}(e,{formSelector:s,inputSelector:u,submitButtonSelector:l,inactiveButtonClass:d,inputErrorClass:p,errorClass:f})}))})();
//# sourceMappingURL=main.js.map