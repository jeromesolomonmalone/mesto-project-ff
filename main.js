(()=>{"use strict";var e=document.querySelector("#card-template").content;function t(t,n,r,o,c,a,i,u,l,s){var d=e.querySelector(".places__item").cloneNode(!0);d.querySelector(".card__image").src=t.link,d.querySelector(".card__image").alt=t.name,d.querySelector(".card__title").textContent=t.name;var p=d.querySelector(".number__likes");p.textContent=t.likes.length;var _=d.querySelector(".card__delete-button");_.addEventListener("click",(function(){n(t._id,d,i,u)}));var f=d.querySelector(".card__like-button");return t.likes.some((function(e){return e._id===o}))?(f.classList.add("card__like-button_is-active"),f.addEventListener("click",(function(){l(t._id,f,p,a,u)}))):f.addEventListener("click",(function(){s(t._id,f,p,c,u)})),o!==t.owner._id&&(_.style.display="none"),d.querySelector(".card__image").addEventListener("click",(function(){r(t)})),d}var n=function(e,t,n,r){var o=t;n(e).then((function(){o.remove()}))},r=function(e,t,n,r,o){var c=t,a=n;r(e).then((function(e){a.textContent=e.likes.length,c.classList.add("card__like-button_is-active")}))},o=function(e,t,n,r,o){var c=t,a=n;r(e).then((function(e){a.textContent=e.likes.length,c.classList.remove("card__like-button_is-active")}))};function c(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",i)}function a(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",i)}function i(e){"Escape"===e.key&&a(document.querySelector(".popup_is-opened"))}function u(e,t){t.textContent=e?"Сохранение...":"Сохранить"}var l=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove("popup__button_disabled"):t.classList.add("popup__button_disabled")};function s(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove("popup__input_type_error"),n.classList.remove("popup__error_visible"),n.textContent="",e.querySelector(".popup__button").classList.add("popup__button_disabled")}var d={baseUrl:"https://nomoreparties.co/v1/wff-cohort-18",headers:{authorization:"4c84455c-b37c-4017-b90f-e1abc3cb4dd2","Content-Type":"application/json"}},p=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},_=function(e){return fetch("".concat(d.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:d.headers}).then(p)},f=function(e){return fetch("".concat(d.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:d.headers}).then(p)},m=function(e){return fetch("".concat(d.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:d.headers}).then(p)},v=document.querySelector(".places__list"),y=document.querySelector(".profile__edit-button"),h=document.querySelector(".profile__add-button"),b=document.querySelector(".popup_type_edit"),S=document.querySelector(".popup_type_new-card"),q=document.querySelector(".popup_type_edit-avatar"),L=document.querySelectorAll(".popup__close"),k=document.querySelectorAll(".popup"),E=document.forms["edit-profile"],g=E.elements.name,C=E.elements.description,x=document.querySelector(".profile__title"),U=document.querySelector(".profile__description"),T=document.forms["new-place"],A=document.querySelector(".popup_type_image"),w=document.querySelector(".profile__image"),D="2fcc5740c8d4ed7400fccd50",P=document.querySelector(".button_edit-profile"),N=document.querySelector(".button_new-place"),O=document.querySelector(".button_edit-avatar"),j=document.forms["edit-avatar"],J=j.elements.avatar;function M(e){A.querySelector(".popup__image").src=e.link,A.querySelector(".popup__image").alt=e.name,A.querySelector(".popup__caption").textContent=e.name,c(A)}fetch("".concat(d.baseUrl,"/cards"),{headers:d.headers}).then(p).then((function(e){e.forEach((function(e){v.append(t(e,n,M,D,f,m,_,null,o,r))}))})),k.forEach((function(e){e.classList.add("popup_is-animated")})),y.addEventListener("click",(function(){g.value=x.textContent,C.value=U.textContent,c(b),s(E,g),s(E,C)})),h.addEventListener("click",(function(){c(S)})),w.addEventListener("click",(function(){c(q)})),L.forEach((function(e){e.addEventListener("click",(function(){k.forEach(a)}))})),k.forEach((function(e){e.addEventListener("click",(function(e){e.target===e.currentTarget&&a(e.currentTarget)}))})),Array.from(document.querySelectorAll(".popup__form")).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e){var t=Array.from(e.querySelectorAll(".popup__input")),n=e.querySelector(".popup__button");l(t,n),t.forEach((function(r){r.addEventListener("input",(function(){!function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove("popup__input_type_error"),n.classList.remove("popup__error_visible"),n.textContent=""}(e,t):function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add("popup__input_type_error"),r.textContent=n,r.classList.add("popup__error_visible")}(e,t,t.validationMessage)}(e,r),l(t,n)}))}))}(e)})),fetch("".concat(d.baseUrl,"/users/me"),{headers:d.headers}).then(p).then((function(e){x.textContent=e.name,U.textContent=e.about,w.style.backgroundImage="url("+e.avatar+")",g.value=x.textContent,C.value=U.textContent,J.value=e.avatar})),E.addEventListener("submit",(function(e){var t;e.preventDefault(),u(!0,P),x.textContent=g.value,U.textContent=C.value,(t={name:g.value,about:C.value},fetch("".concat(d.baseUrl,"/users/me"),{method:"PATCH",headers:d.headers,body:JSON.stringify(t)})).finally((function(){u(!1,P)})),a(b)})),T.addEventListener("submit",(function(e){e.preventDefault(),u(!0,N);var c,i=T.elements["place-name"],l=T.elements.link;(c={name:i.value,link:l.value},fetch("".concat(d.baseUrl,"/cards"),{method:"POST",headers:d.headers,body:JSON.stringify(c)}).then(p)).then((function(e){v.prepend(t(e,n,M,D,f,m,_,null,o,r))})).finally((function(){u(!1,N)})),e.target.reset(),s(T,i),s(T,l),a(S)})),j.addEventListener("submit",(function(e){var t;e.preventDefault(),u(!0,O),w.style.backgroundImage="url("+J.value+")",(t={avatar:J.value},fetch("".concat(d.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:d.headers,body:JSON.stringify(t)})).finally((function(){u(!1,O)})),a(q)}))})();
//# sourceMappingURL=main.js.map